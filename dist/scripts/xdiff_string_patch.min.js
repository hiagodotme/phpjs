function xdiff_string_patch(e,n,t,r){var i=function(e){return[e.global?"g":"",e.ignoreCase?"i":"",e.multiline?"m":"",e.extended?"x":"",e.sticky?"y":""].join("")},l=function(e,n){if(!(n instanceof RegExp))return String.prototype.split.apply(e,arguments);var t,r,l=String(e),a=[],c=0,s=1/0,h=n._xregexp,o=new RegExp(n.source,i(n)+"g");for(h&&(o._xregexp={source:h.source,captureNames:h.captureNames?h.captureNames.slice(0):null});(t=o.exec(l))&&!(o.lastIndex>c&&(a.push(l.slice(c,t.index)),t.length>1&&t.index<l.length&&Array.prototype.push.apply(a,t.slice(1)),r=t[0].length,c=o.lastIndex,a.length>=s));)o.lastIndex===t.index&&o.lastIndex++;return c===l.length?o.test("")&&!r||a.push(""):a.push(l.slice(c)),a.length>s?a.slice(0,s):a},a=0,c=0,s=[],h=0,o=/^@@\s+-(\d+),(\d+)\s+\+(\d+),(\d+)\s+@@$/,g=l(n.replace(/(\r?\n)+$/,""),/\r?\n/),f=l(e,/\r?\n/),u=[],p=0,d=0,x={XDIFF_PATCH_NORMAL:1,XDIFF_PATCH_REVERSE:2,XDIFF_PATCH_IGNORESPACE:4};if("string"!=typeof e||!n)return!1;if(t||(t="XDIFF_PATCH_NORMAL"),"number"!=typeof t){for(t=[].concat(t),a=0;a<t.length;a++)x[t[a]]&&(d|=x[t[a]]);t=d}if(t&x.XDIFF_PATCH_NORMAL){for(a=0,c=g.length;a<c;a++)if(s=g[a].match(o)){for(h=p,p=s[1]-1;h<p;)u[u.length]=f[h++];for(;g[++a]&&null===o.exec(g[a]);)switch(g[a].charAt(0)){case"-":++p;break;case"+":u[u.length]=g[a].slice(1);break;case" ":u[u.length]=f[p++];break;default:throw new Error("Unrecognized initial character in unidiff line")}g[a]&&a--}for(;p>0&&p<f.length;)u[u.length]=f[p++]}else if(t&x.XDIFF_PATCH_REVERSE){for(a=0,c=g.length;a<c;a++)if(s=g[a].match(o)){for(h=p,p=s[3]-1;h<p;)u[u.length]=f[h++];for(;g[++a]&&null===o.exec(g[a]);)switch(g[a].charAt(0)){case"-":u[u.length]=g[a].slice(1);break;case"+":++p;break;case" ":u[u.length]=f[p++];break;default:throw new Error("Unrecognized initial character in unidiff line")}g[a]&&a--}for(;p>0&&p<f.length;)u[u.length]=f[p++]}return r&&(r.value=""),u.join("\n")}